# 要件定義 - 品質向上と不具合修正

## 1. 概要
ユーザーフィードバックに基づき、データの正確性向上、パフォーマンス改善、描画不具合の解消、およびダークモード対応を行う。

## 2. ユーザーストーリー
- **データ正確性**: 私は、10万スターを超えるリポジトリでも、4万件以降が直線にならず、本家のように滑らかな推移を確認したい。
- **パフォーマンス**: 私は、リポジトリを追加したあと、グラフが表示されるまでの待ち時間を短くしたい。
- **不具合修正**:
  - 私は、棒グラフを選択したときに正しくデータが表示されることを期待する。
  - 私は、マウスオーバーしたときに、正しい座標でデータを確認したい。
  - 私は、Log scale を使ったとき、不自然な空白（最小値1固定）がなく、データに最適化されたスケールで見たい。
- **UI/UX**: 私は、夜間でも目に優しいダークモードでツールを使いたい。

## 3. 機能要件

### 3.1 データ取得ロジックの改善 (Smart Sampling)
- **4万件制限の回避**: 
  - 二分探索（Binary Search）を用いて、GitHub APIがエラーを返さない限界のページを特定する。
  - 4万件以降についても、可能な限り細かくサンプリングを試みる。
- **並列取得**: `Promise.all` を活用し、各ページの取得を並列化して高速化する。

### 3.2 描画不具合の修正
- **棒グラフ**: `Chart.js` のデータセット設定を見直し、表示されない問題を修正。
- **ツールチップ**: `intersect: false` や `mode: 'index'` の再調整、およびキャンバスサイズ計算の修正。
- **Log scale オートスケール**: データ内の最小スター数に基づき、キリの良い数値（100, 1000等）を動的に最小値に設定する。

### 3.3 ダークモード対応
- ブラウザの `prefers-color-scheme` に対応。
- Tailwind CSS の `dark:` クラスを活用して配色を切り替える。
- グラフの軸の色や文字色もテーマに合わせて変更。

## 4. 検査基準 (Acceptance Criteria)
- LangChain (12万スター) を追加した際、4万件〜12万件の間にもデータポイントが存在し、滑らかな曲線になること。
- リポジトリ追加から描画完了までの時間が、従来より短縮されていること。
- 棒グラフ・積み上げ棒グラフが正しく描画されること。
- ダークモードに切り替えた際、背景・文字・グラフが適切に表示されること。
