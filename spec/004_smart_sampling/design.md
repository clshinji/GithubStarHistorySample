# 設計書 - ハイブリッド・サンプリング

## 1. データ取得アルゴリズム

### 1.1 ピンポイント・サンプリング
1. 全スター数 $N$ を取得。
2. サンプリング点 $k=40$ を定義。
3. リクエストするページ配列 `pagesToFetch = [1, N/40, 2N/40, ..., N/100]` を作成（各ページは整数化）。
4. 各ページに対し、並列で `stargazers` エンドポイントを叩く。
5. 成功したデータから `{ date: starred_at, count: (page-1)*100 }` を作成。

### 1.2 Search API 補完ロジック
`stargazers` エンドポイントがエラーを返した場合のバックアップ。
- **クエリ**: `GET /search/repositories?q=repo:{fullName}+stars:<={count}`
- このクエリは、そのリポジトリが「指定スター数」以下だった際の状態を検索するものではない（リポジトリ自体の現在のスター数を返すだけ）ため、別のアプローチが必要。
- **正しい Search API 活用**: `GET /search/repositories?q=repo:{fullName}+created:<{date}` で、ある日付時点でのリポジトリ情報を検索することは可能だが、スター数の履歴にはならない。
- **結論**: Search API は「特定の日付のスター数」を直接返す機能に乏しいため、本家同様に **「可能な限りのピンポイント・サンプリング」を突き詰める** 方針とする。

## 2. 描画バグ修正

### 2.1 Chart.js Dataset の修正
- 棒グラフが表示されない原因：`script.js` 内の `updateChart` で、`backgroundColor` や `borderColor` が複数リポジトリ時に正しく適用されていない、または `bar` タイプの指定方法が誤っている可能性がある。
- **対策**: `dataset` オブジェクトの各プロパティを再点検し、Chart.js v4系に準拠した形式に統一する。

## 3. 状態管理の変更
特になし。
